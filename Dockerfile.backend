ARG PYTHON_BASE_IMAGE=swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/library/python:3.13-slim-bullseye
FROM ${PYTHON_BASE_IMAGE}

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

WORKDIR /app

# 安装依赖
COPY app/requirements.txt .
RUN python -m pip install --no-cache-dir -r requirements.txt

# 复制后端代码
COPY app/ .

# 确保用于保存简历的目录存在
RUN mkdir -p uploads

VOLUME ["/app/uploads", "/app/resume_app.db"]

EXPOSE 5000

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "5000"]

